{"version":3,"file":"dutier.js","sources":["../src/providers.js","../src/updateState.js","../src/setReducer.js","../src/asyncReducer.js","../src/applyHandler.js","../src/applyMiddleware.js","../src/dispatch.js","../src/getState.js","../src/unsubscribe.js","../src/subscribe.js","../src/createStore.js","../src/combine.js","../src/middleware.js"],"sourcesContent":["/**\n * The Providers\n */ \nexport const Provider = {\n  // The reducers\n  _reducers: [],\n  // The subscribe handlers\n  _handlers: [],\n  // the middlewares\n  _middlewares: [],\n  // The state manager\n  _updateState: function(){}\n}","/**\n * Creates a Dutier store that holds the state tree.\n * The only way to change the data in the store is to call `dispatch()` on it.\n * @param { Object } state The initial application state\n * @return {Function} currentState Return a function that\n * updates and returns the current state\n */\nexport default (state) => {\n  return (\n    function(state) {\n      return current => {\n        state = Object.assign({}, state, current)\n        return JSON.parse(JSON.stringify(state))\n      }\n    }(state)\n  )\n}\n","import { Provider } from './providers'\nimport create from './updateState'\n\n/**\n * @name setReducer\n * @description Set the reducer function, the\n * initial state of the reducer and store state\n */\nexport default reducers => {\n  // if createStore don't was called yet\n  if (Provider._updateState({}) === undefined) {\n    Provider._updateState = create({})\n  }\n  reducers.forEach( reducer => {\n    const initial = reducer(undefined, { type: '@@DUTIER.INITIAL_STATE' })\n    const index = Provider._reducers.length\n    Provider._reducers[index] = { reducer, initial }\n    Provider._updateState(initial)\n  })\n}\n","import { Provider } from './providers'\n\n/**\n * Async Reducer\n * Just dispatch if return new state payloads.\n * With this, the subscribe function will not be\n * called unnecessary, because the state don't be changed\n */\nexport default action => {\n  return new Promise( resolve  => {\n    Provider._reducers.forEach(({ reducer, initial }) => {\n      const oldState = reducer.current ? Provider._updateState({}) : initial\n      reducer.current = oldState\n      const state = reducer(oldState, action)\n      const reducerState = reducer(oldState, { action: '@@DUTIER.ACTION', payload: action.payload })\n      if (JSON.stringify( reducerState ) !== JSON.stringify(state)) {\n        return resolve({ action, oldState, state: Provider._updateState(state) })\n      }\n    })\n  })\n}\n","import { Provider } from './providers'\n\n/**\n * Apply the subscribe handler functions\n */ \nexport default ({ type, state, payload }) => {\n  Provider._handlers.forEach(handler => {\n    if (handler !== undefined && typeof handler === 'function') {\n      handler({ type, state, payload })\n    }\n  })\n  return { type, state, payload }\n}\n","import { Provider } from './providers'\n\nexport default data => {\n  Provider._middlewares.forEach( middleware => middleware.call(null, data) )\n  return Promise.resolve({ type: data.action.type, payload: data.action.payload, state: data.state });\n}","import asyncReducer from './asyncReducer'\nimport applyHandler from './applyHandler'\nimport applyMiddleware from './applyMiddleware'\n\n/**\n   * @name dispatch\n   * @description Dispatch an action to change\n   * the store state\n   * @param { Object } payload The action payload\n   */  \n  export default payload => {\n    return new Promise( resolve => \n      payload.call(null, resolve )\n    )\n    .then(asyncReducer)\n    .then(applyMiddleware)\n    .then(applyHandler)\n  }","import {Provider} from './providers'\n\n/**\n * @name getState\n * @return {Object} a copy of the state\n */\nexport default () => {\n  return Provider._updateState({})\n}\n","import { Provider } from './providers'\n\n/**\n * @name unsubscribe\n * @description Unsubscribes from listening to a component\n * @param {Function} handler The handler function\n **/\nexport default (handler) => {\n  Provider._handlers.forEach((fn, index) => {\n    if (fn === handler) {\n      Provider._handlers.splice(index, 1)\n    }\n  })\n}\n","import { Provider } from './providers'\nimport unsubscribe from './unsubscribe'\n\n/**\n * Subscribe to receive notifications when state is updated.\n * @name subscribe\n * @description Subscribe to call the handler function when the action will be triggered\n * @param {Function} handler The function that will be called\n **/\nexport default (handler) => {\n  Provider._handlers.push(handler)\n  return () => {\n    unsubscribe(handler)\n  }\n}\n","import { Provider } from './providers'\nimport setReducer from './setReducer'\nimport create from './updateState'\nimport dispatch from './dispatch'\nimport getState from './getState'\nimport subscribe from './subscribe'\n\n/**\n * @name createStore\n * @description Sets the store state\n * @param {Object} data Simple Object that contain the State\n * @param {Function} reducers The action reducers\n */\nexport default ( ...reducers ) => {\n  if (Provider._updateState({}) === undefined) {\n    Provider._updateState = create({})\n  }\n  setReducer(reducers)\n  return { dispatch, subscribe, getState }\n}\n","import setReducer from './setReducer'\n\n/**\n * @name combine\n * @description Combine the reducers\n */  \nexport default (...reducers) => { \n  setReducer(reducers)\n}\n","import { Provider } from './providers'\n\nexport default (...middlewares) => {\n  Provider._middlewares = Provider._middlewares.concat(middlewares)\n} "],"names":["Provider","state","Object","assign","current","JSON","parse","stringify","_updateState","undefined","create","forEach","initial","reducer","type","index","_reducers","length","Promise","oldState","action","reducerState","payload","resolve","_handlers","handler","_middlewares","middleware","call","data","then","asyncReducer","applyMiddleware","applyHandler","fn","splice","push","reducers","dispatch","subscribe","getState","middlewares","concat"],"mappings":"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"}